<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Services\BenchmarkService;

class RunBenchmarks extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'run:benchmarks {--func=*} {count}';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Run benchmarks for specified commands using an existing library';

    protected $functionNames = [
        'bubbleSort' => 'Bubble Sort',
        'quickSort' => 'Quick Sort',
    ];

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    public function handle()
    {
        $functions = $this->option('func');
        $count = $this->argument('count');

        // Array 1000 items in length to give more time to make sorting easier on the eye to see
        $array = [
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4, 3, 3, 3, 13, 55, 65, 66, 82, 97, 87, 19, 71,
            1, 3, 5, 10, 22, 11, 32, 15, 5, 4,
        ];
        $results = [];

        foreach ($functions as $func) {
            $testResult = BenchmarkService::run([$this, $func], $array, $this->functionNames[$func], $count);

            $results[$func] = $testResult;
        }

        dd($results);
    }

    /**
     * Original method from https://github.com/mookofe/php-benchmark
     *
     * @return void
     */
    public function bubbleSort($array)
    {
        if (!$length = count($array)) {
            return $array;
        }

        for ($outer = 0; $outer < $length; $outer++) {
            for ($inner = 0; $inner < $length; $inner++) {
                if ($array[$outer] < $array[$inner]) {
                    $tmp = $array[$outer];
                    $array[$outer] = $array[$inner];
                    $array[$inner] = $tmp;
                }
            }
        }
    }

    /**
     * Original method from https://github.com/mookofe/php-benchmark
     *
     * @return void
     */
    public function quickSort($array)
    {
        if (!$length = count($array)) {
            return $array;
        }

        $k = $array[0];
        $x = $y = array();

        for ($i=1;$i<$length;$i++) {
            if ($array[$i] <= $k) {
                $x[] = $array[$i];
            } else {
               $y[] = $array[$i];
            }
        }
        return array_merge($this->quickSort($x),array($k),$this->quickSort($y));
    }
}
